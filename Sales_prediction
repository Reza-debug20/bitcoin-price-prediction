# ğŸ“Š Ù¾Ø±ÙˆÚ˜Ù‡: ØªØ­Ù„ÛŒÙ„ Ùˆ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ÙØ±ÙˆØ´

# --- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ ---
import os
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score

# --- Ù…Ø³ÛŒØ± Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„ CSV ---
DATA_FILE = "sales.csv"

# --- Ø§Ú¯Ø± ÙØ§ÛŒÙ„ CSV ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªØŒ Ø¨Ø³Ø§Ø² ---
if not os.path.exists(DATA_FILE):
    data = {
        "Date": pd.date_range(start="2023-01-01", periods=24, freq="M"),
        "Product": ["A", "B", "C", "D"] * 6,
        "AdBudget": np.random.randint(1000, 5000, size=24),
        "Sales": np.random.randint(2000, 10000, size=24)
    }
    df = pd.DataFrame(data)
    df.to_csv(DATA_FILE, index=False)
    print("âœ… ÙØ§ÛŒÙ„ sales.csv Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯.")
else:
    print("ğŸ“‚ ÙØ§ÛŒÙ„ sales.csv Ù¾ÛŒØ¯Ø§ Ø´Ø¯.")

# --- Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ---
df = pd.read_csv(DATA_FILE, parse_dates=["Date"])
print("\nğŸ“Œ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡:")
print(df.head())

# --- Ø®Ù„Ø§ØµÙ‡ Ø¢Ù…Ø§Ø±ÛŒ ---
print("\nğŸ“Œ Ø®Ù„Ø§ØµÙ‡ Ø¢Ù…Ø§Ø±ÛŒ:")
print(df.describe())

# --- Ø¨Ø±Ø±Ø³ÛŒ ÙØ±ÙˆØ´ Ù…Ø§Ù‡Ø§Ù†Ù‡ ---
df["Month"] = df["Date"].dt.to_period("M")
monthly_sales = df.groupby("Month")["Sales"].sum()

# Ù†Ù…ÙˆØ¯Ø§Ø± ÙØ±ÙˆØ´ Ù…Ø§Ù‡Ø§Ù†Ù‡
plt.figure(figsize=(10,5))
monthly_sales.plot(kind="line", marker="o")
plt.title("ravande foroshe mahane")
plt.xlabel("mah")
plt.ylabel("mizane forosh")
plt.grid(True)
plt.show()

# --- ØªØµÙˆÛŒØ±Ø³Ø§Ø²ÛŒ ÙØ±ÙˆØ´ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø­ØµÙˆÙ„ ---
plt.figure(figsize=(8,5))
sns.barplot(data=df, x="Product", y="Sales", ci=None)
plt.title("ğŸ“Š Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† ÙØ±ÙˆØ´ Ù‡Ø± Ù…Ø­ØµÙˆÙ„")
plt.show()

# --- Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ù„ ---
X = df[["AdBudget"]]  # ÙˆØ±ÙˆØ¯ÛŒ: Ø¨ÙˆØ¯Ø¬Ù‡ ØªØ¨Ù„ÛŒØºØ§Øª
y = df["Sales"]       # Ø®Ø±ÙˆØ¬ÛŒ: ÙØ±ÙˆØ´

# ØªÙ‚Ø³ÛŒÙ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ø¢Ù…ÙˆØ²Ø´ Ùˆ ØªØ³Øª
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# --- Ù…Ø¯Ù„ Ø±Ú¯Ø±Ø³ÛŒÙˆÙ† Ø®Ø·ÛŒ ---
model = LinearRegression()
model.fit(X_train, y_train)

# Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ
y_pred = model.predict(X_test)

# --- Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù…Ø¯Ù„ ---
print("\nğŸ“Œ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù…Ø¯Ù„:")
print("MAE:", mean_absolute_error(y_test, y_pred))
print("MSE:", mean_squared_error(y_test, y_pred))
print("RÂ²:", r2_score(y_test, y_pred))

# --- Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù†ØªØ§ÛŒØ¬ ÙˆØ§Ù‚Ø¹ÛŒ Ùˆ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ---
plt.figure(figsize=(8,5))
plt.scatter(X_test, y_test, label="ÙˆØ§Ù‚Ø¹ÛŒ")
plt.scatter(X_test, y_pred, label="Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ", marker="x", color="red")
plt.title("ğŸ“Š Ù…Ù‚Ø§ÛŒØ³Ù‡ ÙØ±ÙˆØ´ ÙˆØ§Ù‚Ø¹ÛŒ Ùˆ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒâ€ŒØ´Ø¯Ù‡")
plt.xlabel("Ø¨ÙˆØ¯Ø¬Ù‡ ØªØ¨Ù„ÛŒØºØ§Øª")
plt.ylabel("ÙØ±ÙˆØ´")
plt.legend()
plt.show()